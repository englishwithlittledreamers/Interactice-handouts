<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reading Passage: The Measurement of Time</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff; /* Ensures white background */
        }
        /* Highlight styles - Copied from the provided HTML */
        .highlight-yellow { background-color: #FEF9C3; } /* Yellow-100 */
        .highlight-blue { background-color: #DBEAFE; } /* Blue-100 */
        .highlight-green { background-color: #D1FAE5; } /* Green-100 */
        .highlight-pink { background-color: #FCE7F3; } /* Pink-100 */
        .highlighted-text {
            /* Ensures highlighted text is treated as a single unit for selection */
            display: inline;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 bg-white">
    <div class="bg-white p-6 sm:p-8 md:p-10 rounded-xl w-full max-w-4xl border border-gray-200 shadow-lg">
        <div id="readingPassageContent" class="space-y-4 text-gray-700 text-base sm:text-lg leading-relaxed select-text">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-4">The Measurement of Time</h1>

            <p>The Industrial Revolution of the 18th and 19th centuries opened the way to a series of changes in daily life and human mentality. One example among many is the replacement of the rhythms of traditional agriculture with the uniform and precise schedule of industry.</p>

            <p>Traditional agriculture depended on cycles of natural time and organic growth. Most societies were unable to make precise time measurements, nor were they very interested in doing so. Life went on without clocks and timetables, subject only to the movements of the sun and the growth cycle of plants. There was no uniform working day, and all routines changed drastically from season to season. People knew where the sun was, and watched anxiously for signs of the rainy season and harvest time, but they did not know the hour, and hardly cared about which year it was.</p>

            <p>In contrast to medieval peasants and craftsmen, modern industry cares little about the sun or the season; it values precision and uniformity. For example, in a medieval workshop each shoemaker made an entire shoe, from sole to buckle. If one shoemaker was late for work, it did not hinder the others. However, in a modern, footwear-factory assembly line, every worker mans a machine that produces just a small part of a shoe, which is then passed on to the next machine. If the worker who operates one of the machines was overslept, it hinders all the other machines. In order to prevent such calamities, everybody must adhere to a precise timetable. Each worker arrives at work at exactly the same time, and everybody takes their lunch break together, whether they are hungry or not. Everybody goes home when a whistle announces that the shift is over – not when they have finished their project.</p>

            <p>The Industrial Revolution turned the timetable and the assembly line into a template for almost all human activities. Shortly after factories imposed their time frames on human behaviour, schools too adopted precise timetables, followed by hospitals, government offices and grocery stores. Even in places devoid of assembly lines, the timetable became king.</p>

            <p>A crucial link in the spreading timetable was public transportation. If workers needed to start their shifts by 08.00, the train or bus had to reach the factory gate by 07.55; a few minutes’ delay would lower production and perhaps even lead to the lay-offs of the unfortunate latecomers. In 1784, a carriage service with a published schedule began operating in Britain, but its timetable specified only the hour of departure, not arrival. Back then, each British city and town had its own local time, which could differ from London time by up to half an hour. When it was 12.00 in London, it was perhaps 12.20 in Liverpool, and 11.50 in Canterbury. Since there were no telephones, no radio or television, who could know, and who cared?</p>

            <p>The first commercial train service began operating between Liverpool and Manchester in 1830, and ten years later the first train timetable was issued. The trains were much faster than the old carriages, so the differences in local hours became a severe nuisance. Eventually, in 1847, British train companies put their heads together and agreed that from then on all train timetables would be linked to the time at the Greenwich Observatory in London, rather than to the local times of other towns. More and more institutions followed the lead of the train companies. Finally, in 1880, the British government took the unprecedented step of legislating that all timetables in Britain must follow Greenwich. For the first time in history, a country adopted a national time, and obliged its population to live according to one artificial clock rather than local ones, or sunrise-to-sunset cycles.</p>

            <p>This modest beginning gave rise to a global network of timetables, synchronised down to the tiniest fraction of a second. When the broadcast media – first radio, then television – appeared, they entered a world of timetables and became enthusiastic enforcers. Among the first things radio stations broadcast were time signals, beeps that enabled far-off settlements and seafaring vessels to set their clocks. Later, radio stations adopted the custom of broadcasting the news every hour, and nowadays, the first item of every news broadcast is the time.</p>

            <p>Meanwhile, in order to run the timetable network, inexpensive but precise portable clocks with simple winding mechanisms had spread everywhere. In the world’s ancient cities there might have been at most a few sundials; in European medieval cities there was usually a single clock — a giant machine mounted on top of a high tower in the town square. Today, however, we are surrounded by timepieces: you can tell the time by looking at your wristwatch, glancing at your phone, peering at the alarm clock by the bed, or taking in the taskbar on your computer out of the corner of your eye. You need to make a conscious effort not to know what time it is. The typical person consults these clocks several dozens of times a day, because almost everything we do has to be done on time.</p>
        </div>
    </div>

    <!-- Floating Highlight Toolbar -->
    <div id="floatingToolbar" class="absolute hidden bg-gray-800 p-2 rounded-lg shadow-xl flex items-center space-x-2 z-50">
        <button id="toolbarClearBtn" title="Clear Highlight" class="p-1 rounded-full bg-gray-600 hover:bg-gray-700 text-white text-lg leading-none flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 11-2 0v6a1 1 0 112 0V8z" clip-rule="evenodd" />
            </svg>
        </button>
        <div id="toolbarYellow" title="Highlight Yellow" class="w-6 h-6 rounded-full cursor-pointer bg-yellow-400 hover:bg-yellow-500 transition-colors duration-200" data-color="highlight-yellow"></div>
        <div id="toolbarBlue" title="Highlight Blue" class="w-6 h-6 rounded-full cursor-pointer bg-blue-400 hover:bg-blue-500 transition-colors duration-200" data-color="highlight-blue"></div>
        <div id="toolbarGreen" title="Highlight Green" class="w-6 h-6 rounded-full cursor-pointer bg-green-400 hover:bg-green-500 transition-colors duration-200" data-color="highlight-green"></div>
        <div id="toolbarPink" title="Highlight Pink" class="w-6 h-6 rounded-full cursor-pointer bg-pink-400 hover:bg-pink-500 transition-colors duration-200" data-color="highlight-pink"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const readingPassageContent = document.getElementById('readingPassageContent');
            const floatingToolbar = document.getElementById('floatingToolbar');
            const toolbarClearBtn = document.getElementById('toolbarClearBtn');
            const toolbarYellow = document.getElementById('toolbarYellow');
            const toolbarBlue = document.getElementById('toolbarBlue');
            const toolbarGreen = document.getElementById('toolbarGreen');
            const toolbarPink = document.getElementById('toolbarPink');

            let lastSelectionRange = null;

            // Function to apply highlight to selected text
            function applyHighlight(colorClass) {
                const selection = window.getSelection();
                let range;

                // Use current selection if available, otherwise use the last stored selection
                if (selection.rangeCount > 0 && !selection.isCollapsed) {
                    range = selection.getRangeAt(0);
                } else if (lastSelectionRange) {
                    range = lastSelectionRange;
                    selection.removeAllRanges(); // Clear current selection before re-adding
                    selection.addRange(range);
                } else {
                    // No text selected or previously selected
                    console.log("No text selected to highlight.");
                    return;
                }

                const selectedText = range.toString().trim();
                if (!selectedText) return; // Do nothing if selection is empty

                const span = document.createElement('span');
                span.classList.add(colorClass);
                span.classList.add('highlighted-text'); // Add a class to identify highlighted spans

                try {
                    // Extract the selected content and put it into the new span
                    const contents = range.extractContents();
                    span.appendChild(contents);
                    range.insertNode(span); // Insert the new span back into the document

                    selection.removeAllRanges(); // Clear the selection after highlighting
                    floatingToolbar.classList.add('hidden'); // Hide the toolbar
                    lastSelectionRange = null; // Clear last stored range
                } catch (e) {
                    console.error("Error applying highlight:", e);
                    // Provide user feedback if highlighting fails for complex selections
                    // (e.g., selection spanning across multiple non-text nodes)
                }
            }

            // Function to clear highlight from selected text
            function clearSelectedHighlight() {
                const selection = window.getSelection();
                let range;

                // Use current selection if available, otherwise use the last stored selection
                if (selection.rangeCount > 0 && !selection.isCollapsed) {
                    range = selection.getRangeAt(0);
                } else if (lastSelectionRange) {
                    range = lastSelectionRange;
                    selection.removeAllRanges();
                    selection.addRange(range);
                } else {
                    console.log("No text selected to clear highlight.");
                    return;
                }

                const selectedNode = range.commonAncestorContainer;
                let highlightedSpan = null;

                // Check if the selected node itself is a highlighted span
                if (selectedNode && selectedNode.nodeType === Node.ELEMENT_NODE && selectedNode.classList.contains('highlighted-text')) {
                    highlightedSpan = selectedNode;
                } else {
                    // Traverse up the DOM tree from the selected node to find a parent highlight span
                    let currentNode = selectedNode;
                    while (currentNode && currentNode !== readingPassageContent && currentNode.parentNode) {
                        if (currentNode.nodeType === Node.ELEMENT_NODE && currentNode.classList.contains('highlighted-text')) {
                            highlightedSpan = currentNode;
                            break;
                        }
                        currentNode = currentNode.parentNode;
                    }
                }

                if (highlightedSpan && highlightedSpan.parentNode) {
                    // Replace the highlighted span with its plain text content
                    const textContent = highlightedSpan.textContent;
                    highlightedSpan.parentNode.replaceChild(document.createTextNode(textContent), highlightedSpan);

                    selection.removeAllRanges(); // Clear the selection
                    floatingToolbar.classList.add('hidden'); // Hide the toolbar
                    lastSelectionRange = null; // Clear last stored range
                } else {
                    console.log("No highlight found to clear for this selection.");
                }
            }

            // Event listeners for toolbar buttons
            toolbarYellow.addEventListener('click', () => applyHighlight('highlight-yellow'));
            toolbarBlue.addEventListener('click', () => applyHighlight('highlight-blue'));
            toolbarGreen.addEventListener('click', () => applyHighlight('highlight-green'));
            toolbarPink.addEventListener('click', () => applyHighlight('highlight-pink'));
            toolbarClearBtn.addEventListener('click', clearSelectedHighlight);

            // Show/hide toolbar on text selection (mouseup event)
            readingPassageContent.addEventListener('mouseup', (event) => {
                const selection = window.getSelection();
                // Check if there's a selection and it's not collapsed (i.e., actual text is selected)
                if (selection.rangeCount > 0 && !selection.isCollapsed) {
                    lastSelectionRange = selection.getRangeAt(0); // Store the current selection range
                    const rect = lastSelectionRange.getBoundingClientRect(); // Get the bounding box of the selection
                    const toolbarHeight = floatingToolbar.offsetHeight;
                    const toolbarWidth = floatingToolbar.offsetWidth;

                    // Position the toolbar above the selected text
                    floatingToolbar.style.top = `${rect.top + window.scrollY - toolbarHeight - 10}px`;
                    // Center the toolbar horizontally above the selection
                    let leftPos = rect.left + window.scrollX + (rect.width / 2) - (toolbarWidth / 2);
                    // Ensure the toolbar stays within the viewport boundaries
                    leftPos = Math.max(10, leftPos); // Prevent going too far left
                    leftPos = Math.min(leftPos, window.innerWidth - toolbarWidth - 10); // Prevent going too far right
                    floatingToolbar.style.left = `${leftPos}px`;

                    floatingToolbar.classList.remove('hidden'); // Show the toolbar
                } else {
                    floatingToolbar.classList.add('hidden'); // Hide if no selection
                    lastSelectionRange = null; // Clear last stored range
                }
            });

            // Hide toolbar when clicking outside the toolbar or passage content
            document.addEventListener('mousedown', (event) => {
                // If the click is not inside the toolbar and not inside the reading passage content
                if (!floatingToolbar.contains(event.target) && !readingPassageContent.contains(event.target)) {
                    floatingToolbar.classList.add('hidden'); // Hide the toolbar
                    lastSelectionRange = null; // Clear last stored range
                }
            });
        });
    </script>
</body>
</html>
